<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View User Logs</title>
    <!-- Firebase App (the core Firebase SDK) -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
    <!-- Firebase Database -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            padding: 5px 10px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h2>User Login Logs</h2>
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>User ID</th>
                <th>Email</th>
                <th>Action</th>
                <th>Details</th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody id="log-table-body">
            <!-- Log entries will be inserted here -->
        </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBNqhwnVZW4cmepCFUjlXROClwhrb0GO04",
            authDomain: "velkhana-store.firebaseapp.com",
            databaseURL: "https://velkhana-store-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "velkhana-store",
            storageBucket: "velkhana-store.appspot.com",
            messagingSenderId: "813151184155",
            appId: "1:813151184155:web:4a7f0d933d16efe3a89fbe",
            measurementId: "G-D25CS9PGFW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Reference to the user logs in the database
        const userLogsRef = ref(database, 'userLogs');

        // Listen for changes to the user logs data
        onValue(userLogsRef, (snapshot) => {
            const logs = snapshot.val();
            const logTableBody = document.getElementById('log-table-body');
            logTableBody.innerHTML = ''; // Clear existing rows

            if (logs) {
                for (const key in logs) {
                    if (logs.hasOwnProperty(key)) {
                        const log = logs[key];
                        const row = document.createElement('tr');

                        const timestampCell = document.createElement('td');
                        const date = new Date(log.timestamp);
                        timestampCell.textContent = date.toLocaleString();
                        row.appendChild(timestampCell);

                        const userIdCell = document.createElement('td');
                        userIdCell.textContent = log.userId;
                        row.appendChild(userIdCell);

                        const emailCell = document.createElement('td');
                        emailCell.textContent = log.email;
                        row.appendChild(emailCell);

                        const actionCell = document.createElement('td');
                        actionCell.textContent = log.action;
                        row.appendChild(actionCell);

                        const detailsCell = document.createElement('td');
                        detailsCell.textContent = log.details;
                        row.appendChild(detailsCell);

                        const editCell = document.createElement('td');
                        const editButton = document.createElement('button');
                        editButton.textContent = 'Edit';
                        editButton.addEventListener('click', () => editLog(key, log));
                        editCell.appendChild(editButton);
                        row.appendChild(editCell);

                        logTableBody.appendChild(row);
                    }
                }
            } else {
                const row = document.createElement('tr');
                const noDataCell = document.createElement('td');
                noDataCell.textContent = 'No logs available';
                noDataCell.colSpan = 6;
                noDataCell.style.textAlign = 'center';
                row.appendChild(noDataCell);
                logTableBody.appendChild(row);
            }
        }, (error) => {
            console.error('Error fetching user logs:', error);
        });

        function editLog(key, log) {
            const newDetails = prompt("Enter new details:", log.details);
            if (newDetails !== null) {
                const updates = {};
                updates['/userLogs/' + key + '/details'] = newDetails;
                update(ref(database), updates)
                    .then(() => alert("Log updated successfully"))
                    .catch((error) => console.error("Error updating log:", error));
            }
        }
    </script>
</body>
</html>
